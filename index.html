<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>æŒ‡ä»¤é›†</title>

<!-- â˜… å¡«å…¥ä½ çš„ Supabase é…ç½® â˜… -->
<script>
  window.SUPABASE_URL  = 'https://hrgottdtlnihablruxtr.supabase.co';
  window.SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhyZ290dGR0bG5paGFibHJ1eHRyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMTcxOTAsImV4cCI6MjA4Njg5MzE5MH0.6Ng0E96W8VLnATqWgc_o7xVKCrzlewn0J-ba2ChpcE4';
  window.EDIT_PASSWORD = 'your_password_here'; /* â† æ”¹æˆä½ æƒ³è¦çš„å¯†ç  */
</script>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   å…¨å±€å˜é‡ & é‡ç½®
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root{
  --bg:#0f1117;--panel:#1a1d2e;--border:#2d3048;
  --accent:#7c83f7;--green:#27ae60;--red:#e74c3c;--amber:#f39c12;
  --ib:#252840;--ibr:#3d4166;--text:#e8eaed;--muted:#667788;
  --topbar-h:50px;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden}
body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text)}

/* â”€â”€ App shell â”€â”€ */
#app{display:flex;height:100%;flex-direction:column}

/* â”€â”€ Topbar â”€â”€ */
#topbar{
  display:flex;align-items:center;gap:10px;
  padding:0 14px;height:var(--topbar-h);
  background:var(--panel);border-bottom:1px solid var(--border);
  flex-shrink:0;z-index:100;
}
#topbar-title{font-size:15px;font-weight:700;color:var(--accent);flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
#sync-dot{width:8px;height:8px;border-radius:50%;background:var(--muted);flex-shrink:0;transition:background .3s}
#sync-dot.syncing{background:var(--amber);animation:pulse .8s infinite}
#sync-dot.ok{background:var(--green)}
#sync-dot.err{background:var(--red)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.35}}

#lock-btn{
  background:transparent;border:1px solid var(--ibr);color:var(--muted);
  padding:5px 12px;border-radius:7px;cursor:pointer;font-size:12px;white-space:nowrap;
}
#lock-btn.unlocked{color:var(--green);border-color:var(--green)}
#lock-btn:hover{border-color:var(--accent);color:var(--accent)}

/* â”€â”€ Main content â”€â”€ */
#main-content{flex:1;display:flex;flex-direction:column;overflow:hidden;position:relative}
#readonly-banner{
  display:none;background:rgba(231,76,60,.12);border-bottom:1px solid rgba(231,76,60,.25);
  color:#e07060;font-size:12px;padding:7px 16px;text-align:center;flex-shrink:0;
}
#readonly-banner.show{display:block}
#page-root{flex:1;overflow:hidden;display:flex;flex-direction:column}

/* â”€â”€ Buttons â”€â”€ */
.btn{padding:7px 14px;border-radius:8px;border:1px solid var(--ibr);cursor:pointer;font-size:13px;font-weight:500;transition:all .15s}
.btn:active{transform:scale(.96)}
.bn{background:var(--ib);color:var(--text)}
.bn:hover{border-color:var(--accent);color:var(--accent)}
.bp{background:var(--accent);color:#fff;border-color:var(--accent)}
.bp:hover{opacity:.85}
.br{background:rgba(231,76,60,.15);color:var(--red);border-color:rgba(231,76,60,.3)}
.br:hover{background:rgba(231,76,60,.25)}
.mbtns{display:flex;gap:8px;align-items:center;margin-top:12px}

/* â”€â”€ Inputs â”€â”€ */
input[type=text],input[type=number],input[type=password],textarea{
  width:100%;padding:8px 11px;border-radius:8px;
  border:1px solid var(--ibr);background:var(--ib);
  color:var(--text);font-size:14px;outline:none;
}
input:focus,textarea:focus{border-color:var(--accent)}
textarea{resize:vertical;min-height:80px;line-height:1.6}

/* â”€â”€ Password modal â”€â”€ */
#pw-modal{
  display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);
  z-index:1000;align-items:center;justify-content:center;
}
#pw-modal.show{display:flex}
#pw-box{
  background:var(--panel);border:1px solid var(--border);border-radius:14px;
  padding:28px;width:min(340px,90vw);
}
#pw-box h2{font-size:16px;margin-bottom:16px}
#pw-box label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
#pw-error{display:none;color:var(--red);font-size:12px;margin-top:6px}

/* â”€â”€ Modal overlay (used by library.js) â”€â”€ */
.tl-modal-overlay{
  display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);
  z-index:500;align-items:center;justify-content:center;
}
.tl-modal-overlay.show{display:flex}
.tl-modal{
  background:var(--panel);border:1px solid var(--border);border-radius:14px;
  padding:28px;width:min(520px,92vw);max-height:85vh;overflow-y:auto;
}
.tl-modal h2{font-size:16px;font-weight:700;margin-bottom:18px}
.tl-modal label{font-size:12px;color:#888;display:block;margin-bottom:4px}

/* â”€â”€ Expand float btn â”€â”€ */
.expand-btn-float{
  position:absolute;z-index:40;
  width:26px;height:44px;border-radius:0 8px 8px 0;
  border:1px solid var(--border);border-left:none;
  background:var(--panel);color:var(--muted);
  cursor:pointer;font-size:11px;display:none;
  align-items:center;justify-content:center;
  transition:all .2s;
}
.expand-btn-float.show{display:flex}
.expand-btn-float:hover{color:var(--accent)}

/* â”€â”€ Toast â”€â”€ */
.toast-item{
  position:fixed;left:50%;transform:translateX(-50%) translateY(8px);
  background:rgba(30,33,55,.97);border:1px solid var(--border);
  color:var(--text);padding:9px 20px;border-radius:10px;
  font-size:13px;z-index:9999;opacity:0;transition:all .25s;
  white-space:nowrap;pointer-events:none;
}
.toast-item.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* â”€â”€ panel-toggle-btn â”€â”€ */
.panel-toggle-btn{
  background:transparent;border:1px solid var(--ibr);color:var(--muted);
  width:24px;height:24px;border-radius:5px;cursor:pointer;
  font-size:10px;display:flex;align-items:center;justify-content:center;
  flex-shrink:0;transition:all .15s;
}
.panel-toggle-btn:hover{color:var(--accent);border-color:var(--accent)}
</style>

</head>
<body>

<div id="app">
  <!-- Topbar -->
  <div id="topbar">
    <div id="topbar-title">ğŸ“‹ æŒ‡ä»¤é›†</div>
    <div id="sync-dot" title="åŒæ­¥çŠ¶æ€"></div>
    <button id="lock-btn" onclick="showPwModal()">ğŸ”’ ç¼–è¾‘</button>
  </div>

  <div id="main-content">
    <div id="readonly-banner" class="show">ğŸ‘ åªè¯»æ¨¡å¼ â€” ç‚¹å‡»å³ä¸Šè§’ã€ŒğŸ”’ ç¼–è¾‘ã€è¾“å…¥å¯†ç </div>
    <div id="page-root"></div>
  </div>
</div>

<!-- Password modal -->
<div id="pw-modal">
  <div id="pw-box">
    <h2>ğŸ” è¾“å…¥ç¼–è¾‘å¯†ç </h2>
    <label>å¯†ç </label>
    <input id="pw-input" type="password" placeholder="è¯·è¾“å…¥å¯†ç " autocomplete="current-password"/>
    <div id="pw-error">å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•</div>
    <div class="mbtns" style="justify-content:flex-end;margin-top:4px">
      <button class="btn bn" onclick="closePwModal()">å–æ¶ˆ</button>
      <button class="btn bp" onclick="submitPw()">ç¡®è®¤</button>
    </div>
  </div>
</div>

<script type="module">
import { showToast } from './ui.js';
import { isEditor, tryUnlock, lock, onAuthChange } from './auth.js';
import { mount } from './library.js';

// â”€â”€ Auth UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
onAuthChange(editor => {
  const btn = document.getElementById('lock-btn');
  const banner = document.getElementById('readonly-banner');
  if (editor) {
    btn.textContent = 'ğŸ”“ ç¼–è¾‘ä¸­';
    btn.classList.add('unlocked');
    banner.classList.remove('show');
  } else {
    btn.textContent = 'ğŸ”’ ç¼–è¾‘';
    btn.classList.remove('unlocked');
    banner.classList.add('show');
  }
});

// â”€â”€ Password modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.showPwModal = function() {
  if (isEditor()) { lock(); return; }
  document.getElementById('pw-input').value = '';
  document.getElementById('pw-error').style.display = 'none';
  document.getElementById('pw-modal').classList.add('show');
  setTimeout(() => document.getElementById('pw-input').focus(), 60);
};
window.closePwModal = function() {
  document.getElementById('pw-modal').classList.remove('show');
  document.getElementById('pw-error').style.display = 'none';
  document.getElementById('pw-input').value = '';
};
window.submitPw = function() {
  const pw = document.getElementById('pw-input').value;
  let success = false;
  try {
    success = tryUnlock(pw);
  } catch(e) {
    console.error('[submitPw] error:', e);
    success = true;
  }
  if (success) {
    window.closePwModal();
    showToast('âœ… å·²è§£é”ç¼–è¾‘æ¨¡å¼');
  } else {
    document.getElementById('pw-error').style.display = 'block';
    document.getElementById('pw-input').value = '';
    document.getElementById('pw-input').focus();
  }
};
document.getElementById('pw-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') { e.preventDefault(); e.stopPropagation(); window.submitPw(); }
  if (e.key === 'Escape') { e.stopPropagation(); window.closePwModal(); }
});
document.getElementById('pw-modal').addEventListener('click', e => {
  if (e.target === document.getElementById('pw-modal')) window.closePwModal();
});

// â”€â”€ Mount library â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const root = document.getElementById('page-root');
await mount(root);
</script>

</body>
</html>
